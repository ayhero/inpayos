# ğŸ“Š inpayos æ”¯ä»˜ç½‘å…³æ¶æ„è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: v1.0  
> **æ›´æ–°æ—¶é—´**: 2025å¹´10æœˆ4æ—¥  
> **æ–‡æ¡£ç±»å‹**: ç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ“‹ ç›®å½•

- [1. æ¶æ„æ¦‚è¿°](#1-æ¶æ„æ¦‚è¿°)
- [2. ç³»ç»Ÿæ¶æ„å›¾](#2-ç³»ç»Ÿæ¶æ„å›¾)
- [3. æ ¸å¿ƒä¸šåŠ¡æµç¨‹](#3-æ ¸å¿ƒä¸šåŠ¡æµç¨‹)
- [4. æ¶æ„åˆ†å±‚è¯´æ˜](#4-æ¶æ„åˆ†å±‚è¯´æ˜)
- [5. æ•°æ®æ¨¡å‹è®¾è®¡](#5-æ•°æ®æ¨¡å‹è®¾è®¡)
- [6. å®‰å…¨è®¤è¯ä½“ç³»](#6-å®‰å…¨è®¤è¯ä½“ç³»)
- [7. éƒ¨ç½²æ¶æ„](#7-éƒ¨ç½²æ¶æ„)
- [8. æ‰©å±•æ€§è®¾è®¡](#8-æ‰©å±•æ€§è®¾è®¡)

## 1. æ¶æ„æ¦‚è¿°

inpayos æ˜¯ä¸€ä¸ª**å¤šè¯­è¨€æ”¯æŒçš„æ”¯ä»˜ç½‘å…³æœåŠ¡**ï¼Œé‡‡ç”¨åˆ†å±‚å¤šæœåŠ¡æ¶æ„è®¾è®¡ã€‚ç³»ç»Ÿä¸ºå•†æˆ·æä¾›ç»Ÿä¸€çš„æ”¯ä»˜æ¥å£å…¥å£ï¼Œæ”¯æŒé“¶è¡Œç›´è¿å’Œç¬¬ä¸‰æ–¹æ”¯ä»˜æ¸ é“ï¼Œå…¶ä¸­ Cashier ä½œä¸ºæ ¸å¿ƒæ”¯ä»˜æ¸ é“ä¹‹ä¸€ï¼Œæ”¯æŒå¤šè´¦æˆ·ç‹¬ç«‹è¿è¥ã€‚

### 1.1 æ ¸å¿ƒè®¾è®¡ç†å¿µ

- **ç»Ÿä¸€æ¥å£**: å•†æˆ·åªé€šè¿‡ OpenAPI æ¥å…¥ï¼Œå±è”½æ¸ é“å·®å¼‚
- **æ¸ é“çµæ´»**: æ”¯æŒå¤šç§æ”¯ä»˜æ¸ é“ï¼Œæ˜“äºæ‰©å±•
- **ç®¡ç†åˆ†å±‚**: ä¸åŒè§’è‰²ç®¡ç†å„è‡ªæ•°æ®èŒƒå›´
- **æƒé™éš”ç¦»**: ä¸¥æ ¼çš„æ•°æ®å’Œæƒé™éš”ç¦»æœºåˆ¶
- **å¤šè¯­è¨€**: å®Œæ•´çš„å›½é™…åŒ–æ”¯æŒ

## 2. ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç”¨æˆ·å±‚ (User Layer)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      ğŸ¢ å•†æˆ·ç³»ç»Ÿ                                  â”‚
â”‚                   Merchant Systems                              â”‚
â”‚                  (ç”µå•†/ä¼ä¸šåº”ç”¨)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ [æ”¯ä»˜è¯·æ±‚]
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OpenAPI - æ”¯ä»˜ç½‘å…³ä¸»æ¥å£                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      ğŸŒ OpenAPI Gateway                          â”‚
â”‚                    ç»Ÿä¸€æ”¯ä»˜æ¥å£å…¥å£                               â”‚
â”‚                   Port: 8080                                   â”‚
â”‚                   Auth: API Key (å•†æˆ·å¯†é’¥)                      â”‚
â”‚                                                                 â”‚
â”‚  åŠŸèƒ½ï¼šæ¸ é“è·¯ç”± | æ”¶é“¶å° | äº¤æ˜“ç®¡ç† | çŠ¶æ€å›è°ƒ                    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚               â”‚
      â”‚ [è·¯ç”±åˆ†å‘]      â”‚
      â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ğŸ’°Cashierâ”‚    â”‚ğŸ¦ Bank      â”‚
â”‚Channel  â”‚    â”‚Channel      â”‚
â”‚         â”‚    â”‚             â”‚
â”‚Port:8081â”‚    â”‚Third-Party  â”‚
â”‚API Key  â”‚    â”‚API          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ [Cashieræ¸ é“è¯¦ç»†æ¶æ„]
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CashierAPI - æ”¯ä»˜æ¸ é“å®ç°                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¦ å¤šCashierè´¦æˆ·æ”¯æŒ (ChannelCode = "Cashier")                  â”‚
â”‚                                                                 â”‚
â”‚  AccountID_001 â”‚ AccountID_002 â”‚ AccountID_003 â”‚ AccountID_N   â”‚
â”‚  (å›¢é˜ŸA)       â”‚ (å›¢é˜ŸB)       â”‚ (å›¢é˜ŸC)       â”‚ (å›¢é˜Ÿ...)      â”‚
â”‚                                                                 â”‚
â”‚  å„è‡ªç‹¬ç«‹çš„ï¼š                                                    â”‚
â”‚  â€¢ èµ„é‡‘æ± ç®¡ç†   â€¢ é“¶è¡Œé€šé“é…ç½®   â€¢ é£æ§ç­–ç•¥   â€¢ å¯¹è´¦æµç¨‹          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ç®¡ç†å±‚ (Admin Layer)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸª MerchantAdmin    ğŸ’¼ CashierAdmin      ğŸ‘¨â€ğŸ’¼ GlobalAdmin     â”‚
â”‚  å•†æˆ·æ•°æ®ç®¡ç†         Cashieræ¸ é“ç®¡ç†       å…¨å±€æ•°æ®ç®¡æ§           â”‚
â”‚  Port: 8082         Port: 8083          Port: 8084           â”‚
â”‚  JWT + Merchant     JWT + Cashier       JWT + Admin          â”‚
â”‚                                                               â”‚
â”‚  ç®¡ç†èŒƒå›´ï¼š          ç®¡ç†èŒƒå›´ï¼š            ç®¡ç†èŒƒå›´ï¼š             â”‚
â”‚  â”œ è‡ªå·±çš„å•†æˆ·æ•°æ®     â”œ è‡ªå·±çš„Cashierè´¦æˆ·   â”œ æ‰€æœ‰å•†æˆ·æ•°æ®        â”‚
â”‚  â”œ è‡ªå·±çš„äº¤æ˜“è®°å½•     â”œ è‡ªå·±çš„èµ„é‡‘æµæ°´      â”œ æ‰€æœ‰Cashieræ•°æ®     â”‚
â”‚  â”œ è‡ªå·±çš„APIé…ç½®     â”œ è‡ªå·±çš„é“¶è¡Œé€šé“      â”œ å…¨å±€ç³»ç»Ÿé…ç½®        â”‚
â”‚  â”œ è‡ªå·±çš„æ”¶é“¶å°      â”œ è‡ªå·±çš„é£æ§å‚æ•°      â”œ å¹³å°ç›‘æ§å‘Šè­¦        â”‚
â”‚  â”” è‡ªå·±çš„æ¸ é“åå¥½     â”” è‡ªå·±çš„å¯¹è´¦æ•°æ®      â”” è·¨æ¸ é“æ•°æ®ç»Ÿè®¡      â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å…±äº«ä¸šåŠ¡æœåŠ¡å±‚ (Shared Services)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ’³ TransactionService  ğŸ›’ CheckoutService  ğŸ‘¤ AccountService   â”‚
â”‚  äº¤æ˜“å¤„ç†æœåŠ¡            æ”¶é“¶å°æœåŠ¡           è´¦æˆ·æœåŠ¡             â”‚
â”‚                                                                 â”‚
â”‚  âš™ï¸ ConfigService      ğŸ“¢ NotificationService                  â”‚
â”‚  é…ç½®æœåŠ¡               é€šçŸ¥æœåŠ¡                                  â”‚
â”‚                                                                 â”‚
â”‚  ğŸ” AuthService        ğŸ“Š ReportService                        â”‚
â”‚  è®¤è¯æœåŠ¡               æŠ¥è¡¨æœåŠ¡                                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ•°æ®éš”ç¦»å±‚ (Data Layer)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ’¾ æ•°æ®åº“åˆ†åŒº (Database Partitions)                            â”‚
â”‚                                                                 â”‚
â”‚  ğŸª å•†æˆ·æ•°æ®           ğŸ’¼ Cashieræ•°æ®         ğŸŒ å…¨å±€æ•°æ®        â”‚
â”‚  â”œ merchant_*         â”œ cashier_account_*   â”œ system_config    â”‚
â”‚  â”œ merchant_txn_*     â”œ cashier_txn_*       â”œ global_stats     â”‚
â”‚  â”œ merchant_config_*  â”œ cashier_balance_*   â”œ audit_logs       â”‚
â”‚  â”” api_keys_*         â”” bank_channels_*     â”” notifications    â”‚
â”‚                                                                 â”‚
â”‚  ğŸš€ ç¼“å­˜åˆ†åŒº (Cache Partitions)                                â”‚
â”‚  â”œ merchant_sessions  â”œ cashier_sessions    â”œ global_cache     â”‚
â”‚  â”” merchant_configs   â”” cashier_configs     â”” system_status    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¤–éƒ¨ç³»ç»Ÿ (External Systems)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ¦ é“¶è¡Œç³»ç»Ÿ              ğŸ”— ç¬¬ä¸‰æ–¹æ”¯ä»˜           ğŸ“¡ å•†æˆ·å›è°ƒ      â”‚
â”‚  Banking Systems       Third-Party APIs      Merchant Webhooksâ”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### 3.1 æ”¯ä»˜å¤„ç†æµç¨‹

```
ğŸ¢ å•†æˆ· â”€â”€[APIè°ƒç”¨]â”€â”€â¤ ğŸŒ OpenAPI â”€â”€[æ¸ é“è·¯ç”±]â”€â”€â¤ ğŸ’° CashierAPI(AccountID_X)
                                 â”‚                         â”‚
                                 â”œ[å…¶ä»–æ¸ é“]                â–¼
                                 â””â”€â¤ ğŸ¦ é“¶è¡Œæ¸ é“       ğŸ¦ é“¶è¡Œç³»ç»Ÿ/ç¬¬ä¸‰æ–¹
                                                           â”‚
ğŸ¢ å•†æˆ· â—€â”€â”€[Webhook]â”€â”€â”€â”€ ğŸ“¡ çŠ¶æ€é€šçŸ¥ â—€â”€â”€[å›è°ƒ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ•°æ®ç®¡ç†æµç¨‹

```
ğŸ‘¨â€ğŸ’¼ GlobalAdmin â”€â”€[å…¨å±€ç®¡æ§]â”€â”€â¤ ğŸŒ æ‰€æœ‰æ•°æ®
     â”‚
     â”œâ”€[å®¡æ ¸å¼€é€š]â”€â¤ ğŸª MerchantAdmin â”€â”€[ç®¡ç†]â”€â”€â¤ ğŸ“Š è‡ªå·±å•†æˆ·æ•°æ®
     â”‚
     â””â”€[å®¡æ ¸å¼€é€š]â”€â¤ ğŸ’¼ CashierAdmin â”€â”€[ç®¡ç†]â”€â”€â¤ ğŸ’° è‡ªå·±Cashieræ•°æ®
```

## 4. æ¶æ„åˆ†å±‚è¯´æ˜

### 4.1 ç”¨æˆ·å±‚ (User Layer)

**å•†æˆ·ç³»ç»Ÿ (Merchant Systems)**
- **è§’è‰²**: å”¯ä¸€çš„å¤–éƒ¨ç”¨æˆ·
- **æ¥å…¥æ–¹å¼**: é€šè¿‡ OpenAPI æ¥å…¥
- **å…¸å‹ç”¨æˆ·**: ç”µå•†å¹³å°ã€ä¼ä¸šåº”ç”¨ã€SaaSç³»ç»Ÿ

### 4.2 ç½‘å…³å±‚ (Gateway Layer)

**OpenAPI - æ”¯ä»˜ç½‘å…³ä¸»æ¥å£**
- **ç«¯å£**: 8080
- **è®¤è¯**: API Key (å•†æˆ·å¯†é’¥)
- **æ ¸å¿ƒåŠŸèƒ½**:
  - ç»Ÿä¸€æ”¯ä»˜æ¥å£å°è£…
  - æ™ºèƒ½æ¸ é“è·¯ç”±
  - æ”¶é“¶å°æœåŠ¡
  - äº¤æ˜“çŠ¶æ€ç®¡ç†
  - æ”¯ä»˜å›è°ƒå¤„ç†

### 4.3 æ¸ é“å±‚ (Channel Layer)

**CashierAPI - Cashieræ”¯ä»˜æ¸ é“**
- **ç«¯å£**: 8081
- **è®¤è¯**: API Key (æ¸ é“é—´è°ƒç”¨)
- **æ¸ é“æ ‡è¯†**: ChannelCode = "Cashier"
- **ç‰¹ç‚¹**: æ”¯æŒå¤š AccountIDï¼Œæ¯ä¸ªè´¦æˆ·ç‹¬ç«‹è¿è¥

**ç¬¬ä¸‰æ–¹æ¸ é“**
- é“¶è¡Œç›´è¿æ¸ é“
- å…¶ä»–ç¬¬ä¸‰æ–¹æ”¯ä»˜

### 4.4 ç®¡ç†å±‚ (Admin Layer)

#### MerchantAdmin - å•†æˆ·ç®¡ç†åå°
- **ç«¯å£**: 8082
- **è®¤è¯**: JWT + Merchant æƒé™
- **ç®¡ç†èŒƒå›´**: è‡ªå·±çš„å•†æˆ·æ•°æ®
- **åŠŸèƒ½**:
  - å•†æˆ·è´¦æˆ·ç®¡ç†
  - APIå¯†é’¥ç®¡ç†  
  - äº¤æ˜“æ•°æ®æŸ¥è¯¢
  - æ”¶é“¶å°é…ç½®
  - æ¸ é“åå¥½è®¾ç½®

#### CashierAdmin - Cashieræ¸ é“ç®¡ç†
- **ç«¯å£**: 8083
- **è®¤è¯**: JWT + Cashier æƒé™
- **ç®¡ç†èŒƒå›´**: è‡ªå·±çš„Cashierè´¦æˆ·æ•°æ®
- **åŠŸèƒ½**:
  - Cashierè´¦æˆ·ç®¡ç†
  - èµ„é‡‘æ± ç®¡ç†
  - äº¤æ˜“ç›‘æ§å¯¹è´¦
  - é£æ§å‚æ•°é…ç½®
  - é“¶è¡Œé€šé“ç®¡ç†

#### GlobalAdmin - å…¨å±€ç®¡ç†
- **ç«¯å£**: 8084
- **è®¤è¯**: JWT + Admin æƒé™
- **ç®¡ç†èŒƒå›´**: å…¨å±€æ•°æ®å’Œè·¨æ¸ é“ç»Ÿè®¡
- **åŠŸèƒ½**:
  - å•†æˆ·å‡†å…¥å®¡æ ¸
  - Cashieræ¸ é“å‡†å…¥ç®¡ç†
  - å…¨å±€ç³»ç»Ÿé…ç½®
  - å¹³å°ç›‘æ§å‘Šè­¦
  - è·¨æ¸ é“æ•°æ®ç»Ÿè®¡

### 4.5 æœåŠ¡å±‚ (Service Layer)

æ‰€æœ‰ç®¡ç†å±‚å…±äº«çš„ä¸šåŠ¡æœåŠ¡ï¼š

- **TransactionService**: äº¤æ˜“å¤„ç†æœåŠ¡
- **CheckoutService**: æ”¶é“¶å°æœåŠ¡
- **AccountService**: è´¦æˆ·æœåŠ¡
- **ConfigService**: é…ç½®æœåŠ¡
- **NotificationService**: é€šçŸ¥æœåŠ¡
- **AuthService**: è®¤è¯æœåŠ¡
- **ReportService**: æŠ¥è¡¨æœåŠ¡

### 4.6 æ•°æ®å±‚ (Data Layer)

**æ•°æ®éš”ç¦»ç­–ç•¥**:
- **å•†æˆ·æ•°æ®**: merchant_*, merchant_txn_*, merchant_config_*
- **Cashieræ•°æ®**: cashier_account_*, cashier_txn_*, cashier_balance_*
- **å…¨å±€æ•°æ®**: system_config, global_stats, audit_logs

**ç¼“å­˜åˆ†åŒº**:
- **å•†æˆ·ç¼“å­˜**: merchant_sessions, merchant_configs
- **Cashierç¼“å­˜**: cashier_sessions, cashier_configs
- **å…¨å±€ç¼“å­˜**: global_cache, system_status

## 5. æ•°æ®æ¨¡å‹è®¾è®¡

### 5.1 æ¸ é“è´¦æˆ·æ¨¡å‹

```go
type ChannelAccount struct {
    ID          int64            `json:"id"`
    MID         string           `json:"mid"`           // å•†æˆ·ID
    ChannelCode string           `json:"channel_code"`  // æ¸ é“ä»£ç 
    AccountID   string           `json:"account_id"`    // è´¦æˆ·ID (å”¯ä¸€)
    Secret      string           `json:"secret"`        // è´¦æˆ·å¯†é’¥
    Detail      protocol.MapData `json:"detail"`        // è´¦æˆ·è¯¦ç»†ä¿¡æ¯
    Pkgs        []string         `json:"pkgs"`          // æ”¯æŒçš„åŠŸèƒ½åŒ…
    Status      int              `json:"status"`        // è´¦æˆ·çŠ¶æ€
    Settings    protocol.MapData `json:"settings"`      // è´¦æˆ·è®¾ç½®
    Groups      []string         `json:"groups"`        // æ‰€å±ç»„
    CreatedAt   int64            `json:"created_at"`
    UpdatedAt   int64            `json:"updated_at"`
}
```

### 5.2 æ¸ é“ç»„æ¨¡å‹

```go
type ChannelGroup struct {
    ID        int64         `json:"id"`
    Code      string        `json:"code"`      // ç»„ä»£ç 
    Name      string        `json:"name"`      // ç»„åç§°
    Status    int           `json:"status"`    // ç»„çŠ¶æ€
    Setting   *GroupSetting `json:"setting"`   // ç»„è®¾ç½®
    Members   GroupMembers  `json:"members"`   // ç»„æˆå‘˜
    CreatedAt int64         `json:"created_at"`
    UpdatedAt int64         `json:"updated_at"`
}

type GroupSetting struct {
    Strategy  string `json:"strategy"`   // è·¯ç”±ç­–ç•¥
    Weight    string `json:"weight"`     // æƒé‡é…ç½®
    RankType  string `json:"rank_type"`  // æ’åºç±»å‹
    TimeIndex string `json:"time_index"` // æ—¶é—´ç´¢å¼•
    DataIndex string `json:"data_index"` // æ•°æ®ç´¢å¼•
    Timezone  string `json:"timezone"`   // æ—¶åŒº
}
```

## 6. å®‰å…¨è®¤è¯ä½“ç³»

### 6.1 è®¤è¯æ–¹å¼

#### API Key è®¤è¯
- **åº”ç”¨åœºæ™¯**: OpenAPI â†” å•†æˆ·ç³»ç»Ÿï¼ŒOpenAPI â†” CashierAPI
- **ç‰¹ç‚¹**: æ— çŠ¶æ€è®¤è¯ï¼Œé€‚åˆç³»ç»Ÿé—´è°ƒç”¨
- **å®ç°**: `middleware.APIKeyAuth()`

#### JWT è®¤è¯
- **åº”ç”¨åœºæ™¯**: ç®¡ç†åå°ç”¨æˆ·è®¤è¯
- **ç‰¹ç‚¹**: æœ‰çŠ¶æ€ä¼šè¯è®¤è¯ï¼Œæ”¯æŒç”¨æˆ·ç™»å½•
- **JWT Claims**:
```go
type JWTClaims struct {
    UserType   string `json:"user_type"` // merchant, admin, cashier
    MerchantID string `json:"merchant_id"` 
    Role       string `json:"role"`
}
```

### 6.2 æƒé™æ§åˆ¶

#### ä¸‰å±‚æƒé™ä½“ç³»
- **Merchant**: å•†æˆ·æƒé™ï¼Œåªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- **Cashier**: Cashieræƒé™ï¼Œåªèƒ½è®¿é—®è‡ªå·±è´¦æˆ·çš„æ•°æ®
- **Admin**: ç®¡ç†å‘˜æƒé™ï¼Œå¯ä»¥è®¿é—®å…¨å±€æ•°æ®

#### æƒé™ä¸­é—´ä»¶
- `middleware.MerchantPermissionMiddleware()`
- `middleware.CashierPermissionMiddleware()`
- `middleware.AdminPermissionMiddleware()`

### 6.3 å¤šè¯­è¨€é”™è¯¯å¤„ç†

#### é”™è¯¯ç ä½“ç³»
- **1000-1999**: ç³»ç»Ÿçº§é”™è¯¯
- **2000-2999**: è¯·æ±‚ç›¸å…³é”™è¯¯
- **3000-3999**: è®¤è¯ç›¸å…³é”™è¯¯
- **4000-4999**: å•†æˆ·ç›¸å…³é”™è¯¯
- **5000-5999**: äº¤æ˜“ç›¸å…³é”™è¯¯
- **6000-6999**: æ¸ é“ç›¸å…³é”™è¯¯
- **7000-7999**: Webhookç›¸å…³é”™è¯¯
- **8000-8999**: é…ç½®ç›¸å…³é”™è¯¯

#### é”™è¯¯å“åº”æ ¼å¼
```go
type Result struct {
    Code string `json:"code"`
    Msg  string `json:"msg"`
    Data any    `json:"data,omitempty"`
}
```

## 7. éƒ¨ç½²æ¶æ„

### 7.1 ç«¯å£åˆ†é…

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| OpenAPI | 8080 | æ”¯ä»˜ç½‘å…³ä¸»æ¥å£ |
| CashierAPI | 8081 | Cashieræ”¯ä»˜æ¸ é“ |
| MerchantAdmin | 8082 | å•†æˆ·ç®¡ç†åå° |
| CashierAdmin | 8083 | Cashierç®¡ç†åå° |
| GlobalAdmin | 8084 | å…¨å±€ç®¡ç†åå° |

### 7.2 éƒ¨ç½²é€‰é¡¹

#### å•ä½“éƒ¨ç½²
- æ‰€æœ‰æœåŠ¡è¿è¡Œåœ¨åŒä¸€è¿›ç¨‹
- é€šè¿‡ä¸åŒç«¯å£æä¾›æœåŠ¡
- é€‚åˆä¸­å°è§„æ¨¡éƒ¨ç½²

#### å¾®æœåŠ¡éƒ¨ç½²
- æ¯ä¸ªæœåŠ¡ç‹¬ç«‹éƒ¨ç½²
- é€šè¿‡æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡
- é€‚åˆå¤§è§„æ¨¡åˆ†å¸ƒå¼éƒ¨ç½²

## 8. æ‰©å±•æ€§è®¾è®¡

### 8.1 æ¸ é“æ‰©å±•

æ–°å¢æ”¯ä»˜æ¸ é“åªéœ€ï¼š
1. å®ç°æ ‡å‡†çš„æ¸ é“æ¥å£
2. åœ¨æ¸ é“é…ç½®ä¸­æ³¨å†Œ
3. é…ç½®è·¯ç”±è§„åˆ™

### 8.2 Cashierè´¦æˆ·æ‰©å±•

æ–°å¢Cashierè´¦æˆ·ï¼š
1. åˆ›å»ºæ–°çš„AccountID
2. é…ç½®ç‹¬ç«‹çš„èµ„é‡‘æ± å’Œé“¶è¡Œé€šé“
3. åˆ†é…ç»™Cashierå›¢é˜Ÿç®¡ç†

### 8.3 ç®¡ç†åŠŸèƒ½æ‰©å±•

- æ”¯æŒæ–°çš„ç®¡ç†è§’è‰²
- æ‰©å±•æƒé™æ§åˆ¶ç²’åº¦
- å¢åŠ æ–°çš„ç®¡ç†åŠŸèƒ½æ¨¡å—

### 8.4 å›½é™…åŒ–æ‰©å±•

- æ”¯æŒæ–°è¯­è¨€çš„é”™è¯¯æ¶ˆæ¯
- å¤šæ—¶åŒºæ”¯æŒ
- å¤šå¸ç§æ”¯æŒ

## ğŸ“ æ€»ç»“

inpayos é‡‡ç”¨çš„åˆ†å±‚å¤šæœåŠ¡æ¶æ„è®¾è®¡å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **ç»Ÿä¸€æ¥å£**: å•†æˆ·åªéœ€å¯¹æ¥ OpenAPIï¼Œç®€åŒ–é›†æˆ
2. **æ¸ é“çµæ´»**: æ”¯æŒå¤šç§æ”¯ä»˜æ¸ é“ï¼Œæ˜“äºæ‰©å±•
3. **æƒé™æ¸…æ™°**: ä¸åŒè§’è‰²ç®¡ç†å„è‡ªæ•°æ®ï¼Œæƒé™éš”ç¦»
4. **æ‰©å±•æ€§å¼º**: å¯å•ä½“éƒ¨ç½²æˆ–æ‹†åˆ†ä¸ºå¾®æœåŠ¡
5. **å›½é™…åŒ–**: å®Œæ•´çš„å¤šè¯­è¨€æ”¯æŒ
6. **å®‰å…¨å¯æ§**: å¤šå±‚è®¤è¯å’Œæƒé™æ§åˆ¶æœºåˆ¶

è¿™ç§æ¶æ„è®¾è®¡æ—¢æ»¡è¶³äº†æ”¯ä»˜ç½‘å…³çš„å¤æ‚ä¸šåŠ¡éœ€æ±‚ï¼Œåˆä¿æŒäº†è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œä¸ºæ„å»ºä¼ä¸šçº§æ”¯ä»˜å¹³å°æä¾›äº†åšå®çš„åŸºç¡€ã€‚